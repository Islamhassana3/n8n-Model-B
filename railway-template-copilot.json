{
  "name": "N8N with GitHub Copilot & Workers",
  "description": "Complete N8N automation stack with GitHub Copilot integration, workflow builder, PostgreSQL database, and n8n server with workers",
  "services": [
    {
      "name": "postgres",
      "image": "postgres:15",
      "environment": {
        "POSTGRES_DB": "n8n",
        "POSTGRES_USER": "n8n",
        "POSTGRES_PASSWORD": "${POSTGRES_PASSWORD}"
      },
      "volumes": [
        {
          "path": "/var/lib/postgresql/data",
          "size": "5GB"
        }
      ],
      "healthcheck": {
        "command": "pg_isready -U n8n -d n8n",
        "interval": 30,
        "timeout": 10,
        "retries": 5
      },
      "ports": [5432]
    },
    {
      "name": "redis",
      "image": "redis:7",
      "environment": {
        "REDIS_PASSWORD": "${REDIS_PASSWORD}"
      },
      "volumes": [
        {
          "path": "/data",
          "size": "1GB"
        }
      ],
      "healthcheck": {
        "command": "redis-cli ping",
        "interval": 30,
        "timeout": 10,
        "retries": 5
      },
      "ports": [6379]
    },
    {
      "name": "n8n-primary",
      "image": "n8nio/n8n:latest",
      "environment": {
        "N8N_BASIC_AUTH_ACTIVE": "true",
        "N8N_BASIC_AUTH_USER": "${N8N_ADMIN_USER}",
        "N8N_BASIC_AUTH_PASSWORD": "${N8N_ADMIN_PASSWORD}",
        "DB_TYPE": "postgresdb",
        "DB_POSTGRESDB_HOST": "postgres.railway.internal",
        "DB_POSTGRESDB_PORT": "5432",
        "DB_POSTGRESDB_DATABASE": "n8n",
        "DB_POSTGRESDB_USER": "n8n",
        "DB_POSTGRESDB_PASSWORD": "${POSTGRES_PASSWORD}",
        "N8N_HOST": "https://n8n-primary-${RAILWAY_ENVIRONMENT_ID}.up.railway.app",
        "N8N_PORT": "5678",
        "N8N_PROTOCOL": "https",
        "WEBHOOK_URL": "https://n8n-primary-${RAILWAY_ENVIRONMENT_ID}.up.railway.app",
        "GENERIC_TIMEZONE": "UTC",
        "EXECUTIONS_MODE": "queue",
        "QUEUE_BULL_REDIS_HOST": "redis.railway.internal",
        "QUEUE_BULL_REDIS_PORT": "6379",
        "QUEUE_BULL_REDIS_PASSWORD": "${REDIS_PASSWORD}",
        "N8N_AI_ENABLED": "true",
        "OPENAI_API_KEY": "${OPENAI_API_KEY}",
        "N8N_COPILOT_ENABLED": "true",
        "N8N_COPILOT_PROVIDER": "openai",
        "N8N_ENCRYPTION_KEY": "${N8N_ENCRYPTION_KEY}"
      },
      "depends_on": ["postgres", "redis"],
      "volumes": [
        {
          "path": "/home/node/.n8n",
          "size": "2GB"
        }
      ],
      "healthcheck": {
        "command": "wget --no-verbose --tries=1 --spider http://localhost:5678/healthz || exit 1",
        "interval": 30,
        "timeout": 10,
        "retries": 5
      },
      "ports": [5678]
    },
    {
      "name": "n8n-worker",
      "image": "n8nio/n8n:latest",
      "environment": {
        "DB_TYPE": "postgresdb",
        "DB_POSTGRESDB_HOST": "postgres.railway.internal",
        "DB_POSTGRESDB_PORT": "5432",
        "DB_POSTGRESDB_DATABASE": "n8n",
        "DB_POSTGRESDB_USER": "n8n",
        "DB_POSTGRESDB_PASSWORD": "${POSTGRES_PASSWORD}",
        "EXECUTIONS_MODE": "queue",
        "QUEUE_BULL_REDIS_HOST": "redis.railway.internal",
        "QUEUE_BULL_REDIS_PORT": "6379",
        "QUEUE_BULL_REDIS_PASSWORD": "${REDIS_PASSWORD}",
        "N8N_AI_ENABLED": "true",
        "OPENAI_API_KEY": "${OPENAI_API_KEY}",
        "N8N_ENCRYPTION_KEY": "${N8N_ENCRYPTION_KEY}"
      },
      "depends_on": ["postgres", "redis"],
      "command": "n8n worker",
      "volumes": [
        {
          "path": "/home/node/.n8n",
          "size": "1GB"
        }
      ],
      "ports": []
    },
    {
      "name": "workflow-builder",
      "source": ".",
      "environment": {
        "USE_HTTP": "true",
        "PORT": "1937",
        "N8N_HOST": "https://n8n-primary-${RAILWAY_ENVIRONMENT_ID}.up.railway.app",
        "N8N_API_KEY": "${N8N_API_KEY}",
        "OPENAI_API_KEY": "${OPENAI_API_KEY}",
        "COPILOT_INTEGRATION": "true"
      },
      "depends_on": ["n8n-primary"],
      "healthcheck": {
        "path": "/health",
        "interval": 30,
        "timeout": 10,
        "retries": 5
      },
      "ports": [1937]
    },
    {
      "name": "copilot-panel",
      "image": "ghcr.io/github/copilot-vscode-panel:latest",
      "environment": {
        "GITHUB_TOKEN": "${GITHUB_TOKEN}",
        "COPILOT_API_KEY": "${GITHUB_COPILOT_API_KEY}",
        "N8N_INTEGRATION_URL": "https://n8n-primary-${RAILWAY_ENVIRONMENT_ID}.up.railway.app",
        "WORKFLOW_BUILDER_URL": "https://workflow-builder-${RAILWAY_ENVIRONMENT_ID}.up.railway.app",
        "PORT": "3000",
        "NODE_ENV": "production",
        "PANEL_POSITION": "side",
        "PANEL_WIDTH": "400"
      },
      "depends_on": ["n8n-primary", "workflow-builder"],
      "healthcheck": {
        "path": "/health",
        "interval": 30,
        "timeout": 10,
        "retries": 5
      },
      "ports": [3000]
    }
  ],
  "variables": {
    "N8N_ADMIN_USER": {
      "description": "Admin username for n8n",
      "default": "admin"
    },
    "N8N_ADMIN_PASSWORD": {
      "description": "Admin password for n8n (minimum 8 characters)",
      "required": true
    },
    "POSTGRES_PASSWORD": {
      "description": "PostgreSQL password for n8n user",
      "required": true
    },
    "REDIS_PASSWORD": {
      "description": "Redis password for queue management",
      "required": true
    },
    "N8N_API_KEY": {
      "description": "API key for n8n (generate this in n8n UI after deployment)",
      "required": false
    },
    "N8N_ENCRYPTION_KEY": {
      "description": "Encryption key for n8n credentials (32-character string)",
      "required": true
    },
    "OPENAI_API_KEY": {
      "description": "OpenAI API key for AI/Copilot features",
      "required": true
    },
    "GITHUB_TOKEN": {
      "description": "GitHub Personal Access Token for Copilot integration",
      "required": true
    },
    "GITHUB_COPILOT_API_KEY": {
      "description": "GitHub Copilot API key for advanced features",
      "required": false
    }
  }
}