{
  "name": "N8N Complete Stack",
  "description": "Complete N8N automation stack with workflow builder, MySQL database, and n8n server",
  "services": [
    {
      "name": "mysql",
      "image": "mysql:8.0",
      "environment": {
        "MYSQL_ROOT_PASSWORD": "root_${RAILWAY_ENVIRONMENT_ID}",
        "MYSQL_DATABASE": "n8n",
        "MYSQL_USER": "n8n",
        "MYSQL_PASSWORD": "${MYSQL_PASSWORD}"
      },
      "volumes": [
        {
          "path": "/var/lib/mysql",
          "size": "5GB"
        }
      ],
      "healthcheck": {
        "command": "mysqladmin ping -h localhost",
        "interval": 30,
        "timeout": 10,
        "retries": 5
      },
      "ports": [3306]
    },
    {
      "name": "n8n",
      "image": "n8nio/n8n:latest",
      "environment": {
        "N8N_BASIC_AUTH_ACTIVE": "true",
        "N8N_BASIC_AUTH_USER": "${N8N_ADMIN_USER}",
        "N8N_BASIC_AUTH_PASSWORD": "${N8N_ADMIN_PASSWORD}",
        "DB_TYPE": "mysqldb",
        "DB_MYSQLDB_HOST": "mysql.railway.internal",
        "DB_MYSQLDB_PORT": "3306",
        "DB_MYSQLDB_DATABASE": "n8n",
        "DB_MYSQLDB_USER": "n8n",
        "DB_MYSQLDB_PASSWORD": "${MYSQL_PASSWORD}",
        "N8N_HOST": "https://n8n-${RAILWAY_ENVIRONMENT_ID}.up.railway.app",
        "N8N_PORT": "5678",
        "N8N_PROTOCOL": "https",
        "WEBHOOK_URL": "https://n8n-${RAILWAY_ENVIRONMENT_ID}.up.railway.app",
        "GENERIC_TIMEZONE": "UTC"
      },
      "depends_on": ["mysql"],
      "volumes": [
        {
          "path": "/home/node/.n8n",
          "size": "2GB"
        }
      ],
      "healthcheck": {
        "command": "wget --no-verbose --tries=1 --spider http://localhost:5678/healthz || exit 1",
        "interval": 30,
        "timeout": 10,
        "retries": 5
      },
      "ports": [5678]
    },
    {
      "name": "workflow-builder",
      "source": ".",
      "environment": {
        "USE_HTTP": "true",
        "PORT": "1937",
        "N8N_HOST": "https://n8n-${RAILWAY_ENVIRONMENT_ID}.up.railway.app",
        "N8N_API_KEY": "${N8N_API_KEY}"
      },
      "depends_on": ["n8n"],
      "healthcheck": {
        "path": "/health",
        "interval": 30,
        "timeout": 10,
        "retries": 5
      },
      "ports": [1937]
    }
  ],
  "variables": {
    "N8N_ADMIN_USER": {
      "description": "Admin username for n8n",
      "default": "admin"
    },
    "N8N_ADMIN_PASSWORD": {
      "description": "Admin password for n8n (minimum 8 characters)",
      "required": true
    },
    "MYSQL_PASSWORD": {
      "description": "MySQL password for n8n user",
      "required": true
    },
    "N8N_API_KEY": {
      "description": "API key for n8n (generate this in n8n UI after deployment)",
      "required": false
    }
  }
}